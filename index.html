<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „êµ­ ì•½êµ­ ì •ë³´ ì¡°íšŒ (GCP Cloud Functions)</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            background-color: #f4f7f6; 
            color: #333; 
            line-height: 1.6;
        }
        h1 { 
            color: #2c3e50; 
            text-align: center; 
            margin-bottom: 30px; 
            font-size: 2.5rem;
        }

        /* ê²€ìƒ‰ ì»¨íŠ¸ë¡¤ ì„¹ì…˜ */
        .controls { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 25px; 
            background-color: #fff; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px; /* ìš”ì†Œ ê°„ ê°„ê²© */
        }
        .controls label { 
            margin-right: 8px; 
            font-weight: bold; 
            color: #4a6572;
            white-space: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
        }
        .controls input, 
        .controls select, 
        .controls button {
            padding: 12px 18px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1.05rem;
            box-sizing: border-box; /* íŒ¨ë”©ì´ ë„ˆë¹„ì— í¬í•¨ë˜ë„ë¡ */
        }
        .controls button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            font-weight: bold;
            flex-shrink: 0; /* ë²„íŠ¼ì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
        }
        .controls button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }
        .controls button:active {
            transform: translateY(0);
        }

        /* ì•½êµ­ ëª©ë¡ ì„¹ì…˜ */
        #pharmacyList {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); /* ë°˜ì‘í˜• ê·¸ë¦¬ë“œ */
            gap: 25px; /* ê·¸ë¦¬ë“œ í•­ëª© ê°„ ê°„ê²© */
        }
        .pharmacy-item {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
        }
        .pharmacy-item:hover {
            transform: translateY(-7px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        .pharmacy-item h3 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 12px;
            font-size: 1.5rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        .pharmacy-item p {
            margin: 8px 0;
            font-size: 1rem;
            color: #555;
        }
        .pharmacy-item strong {
            color: #333;
        }
        .pharmacy-item a {
            color: #007bff;
            text-decoration: none;
            margin-top: 10px;
            align-self: flex-start; /* ë§í¬ê°€ ì™¼ìª½ ì •ë ¬ë˜ë„ë¡ */
        }
        .pharmacy-item a:hover {
            text-decoration: underline;
        }

        /* ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .empty-message, .error-message {
            text-align: center;
            margin-top: 50px;
            color: #777;
            font-size: 1.2rem;
            grid-column: 1 / -1; /* ê·¸ë¦¬ë“œ ì „ì²´ ë„ˆë¹„ ì°¨ì§€ */
        }
        .error-message {
            color: #d9534f;
            font-weight: bold;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            .controls label, .controls input, .controls select, .controls button {
                width: 100%;
                margin-right: 0;
            }
            #pharmacyList {
                grid-template-columns: 1fr; /* ëª¨ë°”ì¼ì—ì„œëŠ” 1ì—´ë¡œ */
            }
        }
    </style>
</head>
<body>
    <h1>ì „êµ­ ì•½êµ­ ì •ë³´ ì¡°íšŒ</h1>

    <div class="controls">
        <label for="sido">ì‹œ/ë„:</label>
        <input type="text" id="sido" value="ì„œìš¸íŠ¹ë³„ì‹œ" placeholder="ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ">
        <label for="sigungu">ì‹œ/êµ°/êµ¬:</label>
        <input type="text" id="sigungu" value="ê°•ë‚¨êµ¬" placeholder="ì˜ˆ: ê°•ë‚¨êµ¬">
        <label for="day">ìš”ì¼:</label>
        <select id="day">
            <option value="ì›”">ì›”</option>
            <option value="í™”">í™”</option>
            <option value="ìˆ˜">ìˆ˜</option>
            <option value="ëª©">ëª©</option>
            <option value="ê¸ˆ">ê¸ˆ</option>
            <option value="í† ">í† </option>
            <option value="ì¼">ì¼</option>
            <option value="ê³µíœ´ì¼">ê³µíœ´ì¼</option>
        </select>
        <button onclick="getPharmacies()">ì•½êµ­ ì •ë³´ ì¡°íšŒ</button>
    </div>

    <div id="pharmacyList">
        <p class="empty-message">ìœ„ ê²€ìƒ‰ ì¡°ê±´ìœ¼ë¡œ ì•½êµ­ ì •ë³´ë¥¼ ì¡°íšŒí•´ ë³´ì„¸ìš”.</p>
    </div>

    <script>
        // TODO: **** ì—¬ê¸°ì— ë‹¹ì‹ ì˜ Cloud Functions í˜¸ì¶œ URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”! ****
        // ì˜ˆì‹œ: 'https://getpharmacydata-o5res3extq-du.a.run.app'
        const API_ENDPOINT = 'https://getpharmacydata-o5res3extq-du.a.run.app/'; 

        async function getPharmacies() {
            const sido = document.getElementById('sido').value.trim();
            const sigungu = document.getElementById('sigungu').value.trim();
            const day = document.getElementById('day').value;
            const pharmacyListDiv = document.getElementById('pharmacyList');

            // API_ENDPOINTê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ì„ ê²½ìš° ê²½ê³ 
            if (API_ENDPOINT === 'YOUR_CLOUD_FUNCTIONS_URL_HERE' || !API_ENDPOINT.startsWith('http')) {
                pharmacyListDiv.innerHTML = '<p class="error-message">ğŸš¨ API_ENDPOINTë¥¼ ìì‹ ì˜ Cloud Functions URLë¡œ ë³€ê²½í•´ ì£¼ì„¸ìš”!</p>';
                return;
            }

            pharmacyListDiv.innerHTML = '<p class="empty-message">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';

            try {
                const url = new URL(API_ENDPOINT);
                url.searchParams.append('Q0', sido);
                url.searchParams.append('Q1', sigungu);
                url.searchParams.append('DG', day);

                const response = await fetch(url.toString());
                const data = await response.json();

                if (response.ok) { // HTTP ìƒíƒœ ì½”ë“œê°€ 2xx (ì„±ê³µ)ì¸ ê²½ìš°
                    if (data && data.length > 0) {
                        pharmacyListDiv.innerHTML = data.map(pharmacy => `
                            <div class="pharmacy-item">
                                <h3>${pharmacy.dutyName || 'ì´ë¦„ ì •ë³´ ì—†ìŒ'}</h3>
                                <p><strong>ì£¼ì†Œ:</strong> ${pharmacy.dutyAddr || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}</p>
                                <p><strong>ì „í™”ë²ˆí˜¸:</strong> ${pharmacy.dutyTel1 || 'ì „í™”ë²ˆí˜¸ ì •ë³´ ì—†ìŒ'}</p>
                                <p><strong>ìš´ì˜ì‹œê°„:</strong> ${getOperatingHours(pharmacy, day) || 'ìš´ì˜ì‹œê°„ ì •ë³´ ì—†ìŒ'}</p>
                                ${pharmacy.hospUrl ? `<p><a href="${pharmacy.hospUrl}" target="_blank" rel="noopener noreferrer">í™ˆí˜ì´ì§€ ë°©ë¬¸</a></p>` : ''}
                            </div>
                        `).join('');
                    } else {
                        pharmacyListDiv.innerHTML = '<p class="empty-message">í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ì•½êµ­ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                } else { // HTTP ìƒíƒœ ì½”ë“œê°€ 2xxê°€ ì•„ë‹Œ ê²½ìš° (ì˜ˆ: 4xx, 5xx)
                    pharmacyListDiv.innerHTML = `<p class="error-message">âš ï¸ ì˜¤ë¥˜ ë°œìƒ: ${data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}<br>ìì„¸í•œ ë‚´ìš©ì€ ì½˜ì†”(F12)ì„ í™•ì¸í•˜ì„¸ìš”.</p>`;
                    console.error('API ì‘ë‹µ ì˜¤ë¥˜:', data);
                }
            } catch (error) {
                console.error('ë°ì´í„° ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                pharmacyListDiv.innerHTML = '<p class="error-message">âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
            }
        }

        // ì•½êµ­ ìš´ì˜ì‹œê°„ì„ ìš”ì¼ë³„ë¡œ ê°€ì ¸ì˜¤ëŠ” í—¬í¼ í•¨ìˆ˜
        // NOTE: ê³µê³µë°ì´í„°í¬í„¸ API ë¬¸ì„œì—ì„œ 'ìš´ì˜ì‹œê°„' ê´€ë ¨ í•„ë“œë¥¼ ì •í™•íˆ í™•ì¸í•˜ì—¬ ë§¤í•‘í•´ì•¼ í•©ë‹ˆë‹¤.
        // í˜„ì¬ëŠ” dutyMonC, dutyTueC ë“± ê° ìš”ì¼ë³„ ì¢…ë£Œ ì‹œê°„ í•„ë“œê°€ ìˆì„ ìˆ˜ ìˆë‹¤ëŠ” ê°€ì • í•˜ì— ì˜ˆì‹œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
        // ì‹¤ì œ API ì‘ë‹µ í•„ë“œëª…ê³¼ ì¼ì¹˜ì‹œí‚¤ì„¸ìš”.
        function getOperatingHours(pharmacy, day) {
            // API ì‘ë‹µ í•„ë“œëª…ì— ë”°ë¼ ì •í™•í•˜ê²Œ ìˆ˜ì • í•„ìš”! (ì•„ë˜ëŠ” ì¼ë°˜ì ì¸ ì˜ˆì‹œ)
            const hourMap = {
                'ì›”': pharmacy.dutyMonC,
                'í™”': pharmacy.dutyTueC,
                'ìˆ˜': pharmacy.dutyWedC,
                'ëª©': pharmacy.dutyThuC,
                'ê¸ˆ': pharmacy.dutyFriC,
                'í† ': pharmacy.dutySatC,
                'ì¼': pharmacy.dutySunC,
                'ê³µíœ´ì¼': pharmacy.dutyHolidayC || pharmacy.dutyHoliC // ê³µíœ´ì¼ í•„ë“œëª…ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
            };

            const openTime = pharmacy.dutyTime1c || 'ì•Œ ìˆ˜ ì—†ìŒ'; // ì¼ë°˜ì ì¸ ì‹œì‘ ì‹œê°„ í•„ë“œ
            const closeTime = hourMap[day] || 'ì•Œ ìˆ˜ ì—†ìŒ'; // ìš”ì¼ë³„ ì¢…ë£Œ ì‹œê°„ í•„ë“œ

            if (openTime === 'ì•Œ ìˆ˜ ì—†ìŒ' && closeTime === 'ì•Œ ìˆ˜ ì—†ìŒ') {
                return 'ìš´ì˜ì‹œê°„ ì •ë³´ ì—†ìŒ';
            }
            return `${openTime} ~ ${closeTime}`;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°ì´í„° ë¡œë“œ (ì„ íƒ ì‚¬í•­)
        // getPharmacies();
    </script>
</body>
</html>
